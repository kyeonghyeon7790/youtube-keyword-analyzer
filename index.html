<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube í‚¤ì›Œë“œ ë¶„ì„ ë„êµ¬ â€” ë°ëª¨</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:linear-gradient(135deg,#FF0000 0%,#CC0000 100%); min-height:100vh; padding:20px; }
    .container { max-width:1200px; margin:0 auto; }
    .header { text-align:center; color:#fff; margin-bottom:40px; }
    .header h1 { font-size:2.4rem; margin-bottom:8px; text-shadow:2px 2px 4px rgba(0,0,0,.25); }
    .card { background:#fff; border-radius:20px; padding:28px; box-shadow:0 16px 48px rgba(0,0,0,.25); }
    .search-box { display:flex; gap:12px; margin-bottom:16px; }
    .search-box input { flex:1; padding:14px; border:2px solid #e0e0e0; border-radius:12px; font-size:16px; }
    .search-box input:focus { outline:none; border-color:#FF0000; }
    .search-box button { padding:14px 28px; background:linear-gradient(135deg,#FF0000 0%,#CC0000 100%); color:#fff; border:none; border-radius:12px; font-weight:700; cursor:pointer; }
    .example-keywords { background:#fff3f3; padding:12px; border-radius:10px; margin-bottom:16px; }
    .keyword-tags { display:flex; flex-wrap:wrap; gap:8px; }
    .keyword-tag { background:#fff; color:#FF0000; padding:6px 12px; border-radius:18px; border:1px solid #FFE0E0; cursor:pointer; font-size:14px; }
    .loading { display:none; text-align:center; padding:24px; }
    .loading.active { display:block; }
    .spinner { border:5px solid #f3f3f3; border-top:5px solid #FF0000; border-radius:50%; width:48px; height:48px; animation:spin 1s linear infinite; margin:0 auto 12px; }
    @keyframes spin { 0% {transform:rotate(0)} 100% {transform:rotate(360deg)} }
    .error { display:none; background:#ffe6e6; color:#b00000; border-left:4px solid #b00000; padding:14px; border-radius:10px; margin:12px 0; }
    .error.active { display:block; }
    .result { display:none; margin-top:20px; }
    .result.active { display:block; }
    .result-header { background:linear-gradient(135deg,#FF0000 0%,#CC0000 100%); color:#fff; padding:16px; border-radius:12px; margin-bottom:12px; }
    .analysis-content { background:#f8f9fa; padding:16px; border-radius:12px; line-height:1.8; white-space:pre-wrap; border-left:4px solid #FF0000; }
    .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin:12px 0 16px; }
    .stat-card { background:linear-gradient(135deg,#fff 0%,#f8f9fa 100%); padding:14px; border-radius:10px; border:2px solid #f0f0f0; text-align:center; }
    .stat-card h4 { color:#FF0000; font-size:13px; margin-bottom:6px; }
    .stat-card p { font-weight:800; font-size:22px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ” YouTube í‚¤ì›Œë“œ ë¶„ì„ ë„êµ¬ â€” ë°ëª¨</h1>
      <p>ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ë©´ YouTube Data APIë¡œ ìƒìœ„ ì˜ìƒÂ·ì±„ë„ì„ ìˆ˜ì§‘í•´ ê°„ë‹¨íˆ ë¶„ì„í•©ë‹ˆë‹¤.</p>
    </div>

    <div class="card">
      <div class="search-box">
        <input id="keyword" placeholder="ì˜ˆ: í†µê¸°íƒ€ ë°œë¼ë“œ, íŠ¸ë¡œíŠ¸ ê°€ìš”, ìš´ë™ ë£¨í‹´" />
        <button id="searchBtn">ğŸ” ë¶„ì„í•˜ê¸°</button>
      </div>

      <div class="example-keywords">
        <div class="keyword-tags">
          <span class="keyword-tag" onclick="setKeyword('í†µê¸°íƒ€ ë°œë¼ë“œ')">í†µê¸°íƒ€ ë°œë¼ë“œ</span>
          <span class="keyword-tag" onclick="setKeyword('7080 ë°œë¼ë“œ')">7080 ë°œë¼ë“œ</span>
          <span class="keyword-tag" onclick="setKeyword('íŠ¸ë¡œíŠ¸ ì»¤ë²„')">íŠ¸ë¡œíŠ¸ ì»¤ë²„</span>
          <span class="keyword-tag" onclick="setKeyword('ì—¬ì ë½ ë°œë¼ë“œ')">ì—¬ì ë½ ë°œë¼ë“œ</span>
        </div>
      </div>

      <div id="error" class="error"></div>
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <div>ìœ íŠœë¸Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      </div>

      <div id="result" class="result">
        <div class="result-header">
          <h3>ğŸ“Š ë¶„ì„ ê²°ê³¼</h3>
          <p id="keywordDisplay"></p>
        </div>
        <div class="stats-grid" id="stats"></div>
        <div class="analysis-content" id="resultContent"></div>
      </div>
    </div>
  </div>

  <script>
    // â›”ï¸ í…ŒìŠ¤íŠ¸ í‚¤ ì…ë ¥ (ë°˜ë“œì‹œ ë³¸ì¸ í‚¤ë¡œ êµì²´, ê³µê°œ ê¸ˆì§€)
    const YT_API_KEY = AIzaSyBHc1GHYbPEb3fVFyv_W1QPF88qm_byWbs;

    const el = (id) => document.getElementById(id);
    el('searchBtn').addEventListener('click', analyze);
    el('keyword').addEventListener('keypress', (e)=>{ if(e.key==='Enter') analyze(); });

    function setKeyword(k){ el('keyword').value = k; analyze(); }

    async function analyze(){
      const q = el('keyword').value.trim();
      if(!q){ return showError('ë¶„ì„í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); }
      clearUI(); toggle('loading', true);
      try{
        // 1) ê²€ìƒ‰ ê²°ê³¼
        const search = await ytSearch(q);
        if(!search.items?.length){ return showError('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. í‚¤ì›Œë“œë¥¼ ë³€ê²½í•´ ë³´ì„¸ìš”.'); }

        // 2) ì˜ìƒ ìƒì„¸ + ì±„ë„ ë¬¶ê¸°
        const videoIds = search.items.map(v=>v.id.videoId).filter(Boolean).slice(0,25);
        const videos = await ytVideos(videoIds);
        const channelMap = new Map();
        videos.items.forEach(v=>{
          const cid = v.snippet.channelId;
          const cname = v.snippet.channelTitle;
          const views = Number(v.statistics?.viewCount||0);
          const likes = Number(v.statistics?.likeCount||0);
          if(!channelMap.has(cid)) channelMap.set(cid, { cid, cname, videos:[], totalViews:0, totalLikes:0 });
          const obj = channelMap.get(cid);
          obj.videos.push(v); obj.totalViews += views; obj.totalLikes += likes;
        });

        // 3) ìƒìœ„ ì±„ë„ ì¶”ì¶œ
        const topChannels = [...channelMap.values()].sort((a,b)=>b.totalViews-a.totalViews).slice(0,5);

        // 4) ê°„ë‹¨ ì§€í‘œ
        const totalViews = videos.items.reduce((s,v)=>s+Number(v.statistics?.viewCount||0),0);
        const avgViews = Math.round(totalViews / videos.items.length);
        const avgDuration = avgIsoDuration(videos.items);

        renderStats({ totalVideos: videos.items.length, totalViews, avgViews, avgDuration });

        // 5) íœ´ë¦¬ìŠ¤í‹± ê¸°ë°˜ ë¶„ì„ ë¬¸êµ¬
        const trends = inferTrends(videos.items);
        const audience = inferAudience(videos.items);
        const competition = inferCompetition(videos.items);
        const niches = suggestNiches(q, videos.items, topChannels);

        const text = [
          `1) ì¸ê¸° ì±„ë„\n- ${topChannels.map((c,i)=>`${i+1}. ${c.cname} (ì˜ˆìƒ ëˆ„ì  ì¡°íšŒìˆ˜: ${fmt(c.totalViews)})`).join('\n- ')}`,
          `\n2) ì½˜í…ì¸  íŠ¸ë Œë“œ\n- ${trends.join('\n- ')}`,
          `\n3) ì‹œì²­ì ë¶„ì„\n- ${audience.join('\n- ')}`,
          `\n4) ê²½ìŸ í™˜ê²½\n- ${competition.join('\n- ')}`,
          `\n5) ê¸°íšŒ ë¶„ì„\n- ${niches.join('\n- ')}`
        ].join('\n');

        el('keywordDisplay').textContent = `"${q}" í‚¤ì›Œë“œ ë¶„ì„(ë°ëª¨)`;
        el('resultContent').textContent = text;
        toggle('result', true);
      }catch(err){
        console.error(err); showError('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
      }finally{ toggle('loading', false); }
    }

    function clearUI(){ toggle('result', false); toggle('error', false); el('resultContent').textContent=''; el('stats').innerHTML=''; }
    function toggle(id, on){ el(id).classList[on?'add':'remove']('active'); }
    function showError(m){ el('error').textContent = 'âš ï¸ '+m; toggle('error', true); toggle('loading', false); }

    async function ytSearch(q){
      const url = new URL('https://www.googleapis.com/youtube/v3/search');
      url.search = new URLSearchParams({ key:AIzaSyBHc1GHYbPEb3fVFyv_W1QPF88qm_byWbs, part:'snippet', q, type:'video', maxResults:'25', regionCode:'KR', relevanceLanguage:'ko' });
      const res = await fetch(url); if(!res.ok) throw new Error('YouTube search failed');
      return res.json();
    }

    async function ytVideos(ids){
      const url = new URL('https://www.googleapis.com/youtube/v3/videos');
      url.search = new URLSearchParams({ key: YT_API_KEY, part:'snippet,contentDetails,statistics', id: ids.join(',') });
      const res = await fetch(url); if(!res.ok) throw new Error('YouTube videos failed');
      return res.json();
    }

    function avgIsoDuration(items){
      const secs = items.map(v=>isoToSec(v.contentDetails?.duration||'PT0S')).filter(Boolean);
      const avg = secs.length ? Math.round(secs.reduce((a,b)=>a+b,0)/secs.length) : 0;
      return secToHMS(avg);
    }
    function isoToSec(iso){
      const m = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/); if(!m) return 0; const [_,H,M,S]=m; return (Number(H||0)*3600)+(Number(M||0)*60)+Number(S||0);
    }
    function secToHMS(s){ const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=s%60; return (h?`${h}h `:'')+`${m}m ${sec}s`; }
    function fmt(n){ return new Intl.NumberFormat('ko-KR').format(n); }

    function renderStats({ totalVideos, totalViews, avgViews, avgDuration }){
      el('stats').innerHTML = `
        <div class="stat-card"><h4>ìˆ˜ì§‘ ì˜ìƒ ìˆ˜</h4><p>${fmt(totalVideos)}</p></div>
        <div class="stat-card"><h4>ì´ ì¡°íšŒìˆ˜(í‘œë³¸)</h4><p>${fmt(totalViews)}</p></div>
        <div class="stat-card"><h4>í‰ê·  ì¡°íšŒìˆ˜</h4><p>${fmt(avgViews)}</p></div>
        <div class="stat-card"><h4>í‰ê·  ê¸¸ì´</h4><p>${avgDuration}</p></div>
      `;
    }

    function inferTrends(videos){
      const titles = videos.map(v=>`${v.snippet.title} ${v.snippet.description}`.toLowerCase());
      const hints = [];
      if(titles.some(t=>/cover|ì»¤ë²„|ë¼ì´ë¸Œ/.test(t))) hints.push('ì»¤ë²„/ë¼ì´ë¸Œ í¬ë§·ì˜ ë¹„ì¤‘ì´ ë†’ìŒ');
      if(titles.some(t=>/shorts|ì‡¼ì¸ /.test(t))) hints.push('ì‡¼ì¸  í™œìš© ì¦ê°€(í•˜ì´ë¼ì´íŠ¸/ìš”ì•½)');
      if(titles.some(t=>/official|mv|ë®¤ì§ë¹„ë””ì˜¤/.test(t))) hints.push('ê³µì‹ MVÂ·í•˜ì´ë¼ì´íŠ¸ ê²½ìŸ ì¡´ì¬');
      if(hints.length===0) hints.push('íŠœí† ë¦¬ì–¼/ë¦¬ë·°/í•˜ì´ë¼ì´íŠ¸ í˜¼í•©í˜• íŠ¸ë Œë“œ');
      return hints;
    }
    function inferAudience(videos){
      const hints = [];
      const hasLive = videos.some(v=>/live|ë¼ì´ë¸Œ/i.test(v.snippet.title));
      const avgDur = isoToSec(avgIsoDurationObj(videos));
      if(hasLive) hints.push('ì‹¤ì‹œê°„Â·ê³µì—°í˜• ì½˜í…ì¸  ì„ í˜¸ì¸µ ì¡´ì¬');
      hints.push('í•œêµ­ì–´ ë©”ì¸ íƒ€ê¹ƒ(ko ì§€ì—­/ì–¸ì–´ ê¸°ì¤€)');
      if(avgDur>600) hints.push('10ë¶„+ ì¤‘ì¥í¸ë„ ì‹œì²­ ìˆ˜ìš” ìˆìŒ'); else hints.push('ì§§ì€ ì˜ìƒ(â‰¤10ë¶„) ì„ í˜¸ ê²½í–¥');
      return hints;
    }
    function avgIsoDurationObj(items){
      const sum = items.reduce((a,v)=>a+isoToSec(v.contentDetails?.duration||'PT0S'),0);
      const avg = items.length?Math.round(sum/items.length):0; return { contentDetails:{ duration: secToISO(avg) } };
    }
    function secToISO(s){ const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=s%60; return `PT${h?h+'H':''}${m?m+'M':''}${sec?sec+'S':''}`; }
    function inferCompetition(videos){
      const avg = Math.round(videos.reduce((a,v)=>a+Number(v.statistics?.viewCount||0),0)/(videos.length||1));
      return [ avg > 100000 ? 'ìƒë‹¹í•œ ê²½ìŸ(í‰ê·  ì¡°íšŒìˆ˜ 10ë§Œ+)' : avg > 20000 ? 'ì¤‘ê°„ ê²½ìŸ(í‰ê·  2ë§Œ+)' : 'ë‚®ì€ ê²½ìŸ(í‰ê·  2ë§Œ ë¯¸ë§Œ)' ];
    }
    function suggestNiches(q, videos, topChannels){
      const niches = [];
      if(videos.some(v=>/shorts|ì‡¼ì¸ /i.test(v.snippet.title))) niches.push('ì‡¼ì¸  + ë¡±í¼ ì—°ê³„(ìš”ì•½â†’í’€ë²„ì „ ë§í¬)');
      niches.push('ì¸ë„¤ì¼ A/B í…ŒìŠ¤íŠ¸(ì¸ë¬¼ í´ë¡œì¦ˆì—… vs í…ìŠ¤íŠ¸ ê°•ì¡°)');
      niches.push('[ì œëª©] í‚¤ì›Œë“œ+ê°ì •ì–´(ì˜ˆ: ê³µê°, ëˆˆë¬¼, ë ˆì „ë“œ) ì¡°í•©');
      niches.push('ì½œë¼ë³´/ë“€ì—£Â·ë¼ì´ë¸Œ í´ë¦½ ì‹œë¦¬ì¦ˆí™”');
      if(/ë°œë¼ë“œ|íŠ¸ë¡œíŠ¸|í†µê¸°íƒ€/.test(q)) niches.push('MR/ê°€ì‚¬ ìë§‰Â·ë¬´ëŒ€ ì„¸íŠ¸ ë©”ì´í‚¹ ì½˜í…ì¸ ');
      if(topChannels.length>=3) niches.push('ìƒìœ„ 3ê°œ ì±„ë„ ì—…ë¡œë“œ ë¹ˆë„Â·ì‹œê°„ëŒ€ ë²¤ì¹˜ë§ˆí‚¹');
      return niches;
    }
  </script>
</body>
</html>